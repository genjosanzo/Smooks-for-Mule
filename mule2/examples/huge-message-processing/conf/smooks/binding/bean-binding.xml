<?xml version="1.0"?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.0.xsd">

	<!-- We create this empty Product object so that MVEL won't complain that the product variable isn't bound in the
		 MVEL context when the routing conditions get fired on the visit before on the product element. Because no product
		 exists the first time in the before visits.
		 Smooks 1.1 has a fix for this Small problem.
	 -->
	<resource-config selector="$document">
		<resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">product</param>
        <param name="beanClass">example.hmp.model.Product</param>
	</resource-config>

    <resource-config selector="product">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">product</param>
        <param name="beanClass">example.hmp.model.Product</param>
        <param name="bindings">
        	<binding property="id" type="Long" selector="product id" />
        	<binding property="name" selector="product name" />
        	<binding property="brand" selector="product brand" />
        	<binding property="category" selector="product category" />
        	<binding property="price" type="BigDecimal" selector="product price" />
        	<binding property="tax" type="Integer" selector="product tax" />
        	<binding property="guarantee" selector="product guarantee" />

        	<binding property="parts" selector="${parts}" />
        	<binding property="specs" selector="${specs}" />
        </param>
    </resource-config>

	<resource-config selector="product">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">parts</param>
        <param name="beanClass">java.util.ArrayList</param>
        <param name="bindings">
        	<binding selector="${part}" />
        </param>
	</resource-config>

	<resource-config selector="product part">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">part</param>
        <param name="beanClass">example.hmp.model.Part</param>
        <param name="bindings">
        	<binding property="id" type="Long" selector="part id" />
        	<binding property="quantity" type="Integer" selector="product part quantity" />
        	<binding property="buildIn" type="Boolean" selector="product part build-in" />
        </param>
    </resource-config>

	<resource-config selector="product">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">specs</param>
        <param name="beanClass">java.util.ArrayList</param>

        <param name="bindings">
        	<binding selector="${spec}" />
        </param>
	</resource-config>

    <resource-config selector="product spec">
        <resource>org.milyn.javabean.BeanPopulator</resource>
        <param name="beanId">spec</param>
        <param name="beanClass">example.hmp.model.Spec</param>
        <param name="bindings">
        	<binding property="name" selector="spec name" />
        	<binding property="value" selector="spec value" />
        </param>
    </resource-config>

</smooks-resource-list>
