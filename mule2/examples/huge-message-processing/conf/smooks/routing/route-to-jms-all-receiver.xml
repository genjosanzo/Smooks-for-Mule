<?xml version="1.0"?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.1.xsd"
	xmlns:mule="http://dist.muleforge.org/smooks/schema/smooks-mule-1.2.xsd"
	xmlns:ftl="http://www.milyn.org/xsd/smooks/freemarker-1.1.xsd">

	<!--
   		This FreeMarker template resource configuration generates the XML
   		at the end of every product. It binds the XML String in the bean map under
   		bean ID 'XML_ReceiveAllProducts'.
	-->
	<ftl:freemarker applyOnElement="product">
		<ftl:template><!--
	    <product number="${product.id?c}">
	        <name>${product.name}</name>
	        <brand>${product.brand}</brand>
	        <category>${product.category}</category>
	        <price>${product.price?c}</price>
	        <tax>${product.tax?c}</tax>
	        <guarantee>${product.guarantee}</guarantee>
	        <parts>
	        <#list product.parts as part>
	           <part number="${part.id?c}">
	             <quantity>${part.quantity?c}</quantity>
	             <buildIn>${part.buildIn?string}</buildIn>
	           </part>
	        </#list>
	        </parts>
	        <specifications>
	        <#list product.specs as spec>
	           <#assign nodeName = spec.name?replace(' ', '-')?lower_case>
	           <${nodeName}>${spec.value}</${nodeName}>
	        </#list>
	        </specifications>
	    </product>-->
	    </ftl:template>
    	<ftl:use><ftl:bindTo id="XML_ReceiveAllProducts"/></ftl:use>
	</ftl:freemarker>

	<!--
   		This Mule dispatcher resource configuration executes at the end of every product.
   		It dispatches the product XML to the 'ReceiveAllProductsEndpoint' endpoint.
   		The XML is retrieved from the 'XML_ReceiveAllProducts' String from the bean Map.
   		This XML is generated by the next resource configuration.
	-->
	<mule:dispatcher endpointName="ReceiveAllProductsEndpoint" dispatchOnElement="product">
		<mule:messagePayload beanId="XML_ReceiveAllProducts" />
	</mule:dispatcher>

</smooks-resource-list>
