<?xml version="1.0"?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.0.xsd">

	<!--
   		This MuleDispatcher resource configuration executes at the end of every product.
   		It dispatches the product XML to the 'ReceiveAllProductsEndpoint' endpoint.
   		The XML is retrieved from the 'XML_ReceiveAllProducts' String from the bean Map.
   		This XML is generated by the next resource configuration.

   		For the same reasons as explained in the top of the config.xml file the dispatch
   		configurion must come for the XML generating configuration. Both execute in the
   		visit after action.
	-->
	<resource-config selector="product">
		<resource>org.milyn.smooks.mule.MuleDispatcher</resource>
		<param name="endpointName">ReceiveAllProductsEndpoint</param>
		<param name="beanId">XML_ReceiveAllProducts</param>
	</resource-config>

	<!--
   		This FreeMarker template resource configuration generates the XML
   		at the end of every product. It binds the XML String in the bean map under
   		bean ID 'XML_ReceiveAllProducts'.
	-->
	<resource-config selector="product">
		<resource type="ftl"><!--
    <product number="${product.id?c}">
        <name>${product.name}</name>
        <brand>${product.brand}</brand>
        <category>${product.category}</category>
        <price>${product.price?c}</price>
        <tax>${product.tax?c}</tax>
        <guarantee>${product.guarantee}</guarantee>
        <parts>
        <#list product.parts as part>
           <part number="${part.id?c}">
             <quantity>${part.quantity?c}</quantity>
             <buildIn>${part.buildIn?string}</buildIn>
           </part>
        </#list>
        </parts>
        <specifications>
        <#list product.specs as spec>
           <#assign nodeName = spec.name?replace(' ', '-')?lower_case>
           <${nodeName}>${spec.value}</${nodeName}>
        </#list>
        </specifications>
    </product>--></resource>
		<param name="action">bindto</param>
		<param name="bindId">XML_ReceiveAllProducts</param>
	</resource-config>

</smooks-resource-list>
